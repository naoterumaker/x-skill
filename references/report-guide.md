# generate_summary_md.py レポート生成ガイド

任意のテーマ・複数 JSON から「何が語られているか」を中心に MD + xlsx レポートを生成する汎用ツール。

## 基本コマンド

```bash
python3 ~/.claude/skills/x-research/generate_summary_md.py \
  --name "テーマ名 バズ分析" \
  --files /tmp/a.json /tmp/b.json \
  --labels "ラベルA" "ラベルB" \
  --queries "クエリA" "クエリB" \
  --exclude {noise_tweet_id} \
  --titles /tmp/titles.json
```

## 全オプション

| オプション | 必須 | 説明 |
|-----------|------|------|
| `--name` | Yes | レポートタイトル |
| `--files` | Yes | JSON ファイルパス（複数可） |
| `--labels` | No | 各ファイルのラベル名（省略時はファイル名） |
| `--queries` | No | 検索クエリ文字列（レポートに表示） |
| `--exclude` | No | 除外するツイート ID（手動ノイズ除去、複数可） |
| `--titles` | No | X記事タイトルの JSON マッピング `{tweet_id: "タイトル"}` |
| `--topics` | No | カスタム TOPIC_RULES の JSON ファイル |
| `--no-noise-filter` | No | 自動ノイズ除去を無効化 |
| `--out-dir` | No | 出力先（default: `~/.claude/skills/x-research/reports`） |
| `--no-xlsx` | No | xlsx 出力をスキップ |

## 出力先

`reports/YYYY-MM-DD/テーマ名/テーマ名.md` + `テーマ名.xlsx`

## 自動ノイズ除去

デフォルトで有効。以下の言語を自動検出 & 除外:
- 韓国語（ハングル文字）
- ポルトガル語（特有の単語パターン）
- スペイン語（特有の単語パターン）
- アラビア語（アラビア文字5文字以上）

日本語保護: ひらがな/カタカナを含むテキストは除外しない。
除外結果は stderr に出力。

## MD 出力セクション

1. **何が語られているか** — TOPIC_RULES による自動話題検出、トピック別いいね合計 + 例（重複なし）
2. **キーパーソン** — アカウント別プロファイル（話題・形式・投稿サンプル、話題不明は除外）
3. **次にやるべきこと** — 5項目のアクションプラン（フォーマット・話題・切り口・保存率・避けるべき）
4. **バズ TOP10** — 各投稿の全文・タグ・バズ効率・ポスト URL
5. **数値サマリー** — クエリ一覧、全体指標テーブル、ラベル別比較
6. **保存されるコンテンツ（保存率 TOP5）** — ブクマ/いいね比率が高い実用系
7. **外部リンク** — ツイートから共有された外部 URL 集

## xlsx シート構成（7シート）

1. **全ツイート** — いいね順一覧（話題列付き、バズ効率 ≥ 1.0 を緑ハイライト）
2. **戦略的インサイト** — 全体概要、トピック強度、バズパターン分析、高保存率 TOP10、勝ちパターン
3. **アカウント別** — ユーザーごとの話題・合計いいね・平均保存率・主な投稿タイプ
4. **バズ効率 TOP15** — フォロワー比で最も効率よくバズった投稿
5. **クロス集計** — トピック × 投稿タイプのマトリクス（件数 + いいね）
6. **ラベル別** — ラベルごとの件数・いいね・保存率比較（複数ラベル時のみ）
7. **投稿タイプ別** — タイプごとの件数・いいね・保存率・バズ効率

## 話題検出（TOPIC_RULES）

**デフォルトルール（マーケ向け）:**
- LP/Web制作, SEO/検索流入, AI活用/テック, コンテンツ制作, AI副業/収益化
- ビジネス/起業, 𝕏攻略/SNS, 広告/集客, 速報/ニュース

短い英単語キーワード（4文字以下: ai, seo, gpt, lp, css 等）はワードバウンダリ `\b` で検索し、誤マッチを防止。

**カスタムルール:** テーマに応じて `--topics` で JSON ファイルを渡す:

```json
[
  {"name": "LP/Web制作", "keywords": ["lp", "ランディング", "figma", "html"]},
  {"name": "SEO/検索流入", "keywords": ["seo", "検索", "google", "organic"]},
  {"name": "AI活用/テック", "keywords": ["claude", "chatgpt", "ai", "プロンプト"]}
]
```

`--topics` 省略時はスクリプト内蔵のデフォルトルールを使用。

## バズ要因タグ

自動付与されるタグ: X記事, ビジュアル, 短文一撃, ハウツー/まとめ, 収益系, 体験談/リアル, 速報/リリース, スレッド, 問いかけ, 高保存率

## X記事の扱い

- X記事（`x.com/i/article/` 等）のテキストが t.co リンクのみの場合、`--titles` でタイトル JSON を渡す
- テキストが既にある場合（大半のケース）はタイトル取得不要
- Chrome 操作でタイトル取得: `mcp__claude-in-chrome__navigate` → `get_page_text`
